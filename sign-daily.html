<!DOCTYPE html>
<!--
🚧 CONSTRUCTION SIGN DIARIES - FIREBASE EDITION

📋 SETUP CHECKLIST:

1. 🔥 FIREBASE SETUP:
   • Create project: https://console.firebase.google.com
   • Enable Firestore Database (test mode)
   • Enable Storage
   • Copy config from Project Settings > General
   • Replace firebaseConfig object around line 680

2. 📁 YOUR EXACT GITHUB PAGES STRUCTURE:
   Repository: https://github.com/og-nater-tater/mywebiste/tree/52aa664608fa5a456ed7b5fef1e0604dae3aac60/signs
   App URL: https://og-nater-tater.github.io/mywebiste/sign-daily.html
   PDF URLs: https://og-nater-tater.github.io/mywebiste/signs/{technical-name}.pdf
   
   Required structure:
   /mywebiste/
   ├── sign-daily.html          ← Your app here
   └── /signs/                  ← PDFs here (EXACT location)
       ├── TC-1.pdf             ← Direct GitHub Pages URL
       ├── TC-2A.pdf            ← Named by technical sign name
       ├── Ra-1.pdf             ← Accessible via absolute URL
       └── [more PDFs...]       ← Each at: og-nater-tater.github.io/mywebiste/signs/

3. 🎯 FIRST TIME SETUP:
   • Replace Firebase config below
   • Open the app in browser
   • Click "Create Sample Signs" to populate database
   • Add your actual sign images to /images/ folder

4. 🔐 SECURITY (LATER):
   • Update Firestore rules for production
   • Set up authentication if needed

-->
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Construction Sign Diaries</title>

  <!-- Styles (CSS) -->
  <style>
    /* Reset & Base */
    * { box-sizing: border-box; margin:0; padding:0 }
    html, body { height:100% }
    body {
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;
      background:#f2f4f8; color:#333;
      display:flex; overflow:hidden;
    }
    a { text-decoration:none; color:inherit }
    button,input,select,textarea { font-family:inherit; font-size:.95rem }

    /* Sidebar */
    #sidebar {
      width:220px; background:#00345b; color:#fff; flex-shrink:0;
      border-right:2px solid #0a4471;
    }
    body.sidebar-collapsed #sidebar { display:none }
    #sidebar h2 {
      margin:1rem; font-size:1.25rem; font-weight:600;
      border-bottom:1px solid rgba(255,255,255,.2); padding-bottom:.5rem;
    }
    #sidebar nav { display:flex; flex-direction:column }
    #sidebar nav button {
      background:none; border:none; color:#fff;
      padding:.75rem 1rem; text-align:left; cursor:pointer;
      border-top:1px solid rgba(255,255,255,.1); transition:background .2s;
    }
    #sidebar nav button.active,
    #sidebar nav button:hover { background:#005a9c }

    /* Main */
    #main { flex-grow:1; overflow-y:auto; padding:1.5rem 2rem }
    #toggle-sidebar {
      background:#005a9c; color:#fff; border:none;
      padding:.5rem 1rem; border-radius:4px; cursor:pointer;
      margin-bottom:1rem; transition:.2s;
    }
    #toggle-sidebar:hover { background:#00417c }
    #quit-app-btn:hover { background:#c82333 }
    .section { display:none }
    .section.active { display:block }
    h1 { color:#00345b; font-size:1.5rem; margin-bottom:1rem }
    h2,h3 { color:#00345b; font-size:1.15rem; margin-bottom:.5rem }

    /* Forms */
    .form-group { margin-bottom:1rem }
    .form-group label {
      display:block; font-weight:500; margin-bottom:.25rem; color:#00345b
    }
    .form-group input[type="text"],
    .form-group input[type="date"],
    .form-group select,
    #sign-search,
    #daily-sign-search {
      width:100%; padding:.5rem .6rem; border:1px solid #ccc;
      border-radius:5px; background:#fff; transition:border-color .2s
    }
    .form-group input:focus,
    .form-group select:focus,
    #sign-search:focus,
    #daily-sign-search:focus { 
      outline:none; border-color:#005a9c 
    }
    
    #sign-search:disabled,
    #daily-sign-search:disabled {
      background:#f5f5f5; color:#999; cursor:not-allowed;
    }
    .btn {
      background:#005a9c; color:#fff; border:none;
      padding:.55rem 1.1rem; border-radius:5px; cursor:pointer;
      margin-bottom:.5rem; transition:.2s; font-weight:500;
    }
    .btn:hover:not(:disabled) { background:#00417c }
    .btn:disabled { 
      background:#999; cursor:not-allowed; color:#ddd;
    }
    .btn.secondary {
      background:#6c757d; color:#fff;
    }
    .btn.secondary:hover { background:#5a6268 }
    .btn.success {
      background:#28a745; color:#fff;
    }
    .btn.success:hover { background:#218838 }

    /* Lists & Tables */
    .item-list {
      margin-top:.5rem; max-height:300px; overflow-y:auto;
      background:#fff; border:1px solid #ccc; border-radius:5px
    }
    .item-list div {
      padding:.6rem 1rem; border-bottom:1px solid #eee;
      display:flex; justify-content:space-between; align-items:center;
      transition:background .2s
    }
    .item-list div:last-child { border-bottom:none }
    .item-list div:hover { background:#f4f6f8 }
    .item-list button {
      background:none; border:none; color:#d00; cursor:pointer;
      transition:.2s
    }
    .item-list button:hover { color:#b00; text-decoration:underline }

    table {
      width:100%; border-collapse:collapse; background:#fff;
      margin:.75rem 0 1.25rem; border-radius:5px; overflow:hidden
    }
    table th, table td {
      border:1px solid #ccc; padding:.6rem .8rem; text-align:left
    }
    table th { background:#e1eaf8; color:#00345b; font-weight:600 }

    /* Perm cards */
    #perm-grid {
      display:grid; grid-template-columns:repeat(auto-fill,minmax(200px,1fr));
      gap:1rem; margin-top:1rem;
      align-items: start;
    }
    .perm-card {
      background:#fff; border:1px solid #ccc; border-radius:8px;
      padding:.75rem; display:flex; flex-direction:column; gap:.5rem;
      box-shadow:0 1px 3px rgba(0,0,0,.1); transition:.2s;
      height: fit-content;
    }
    .perm-card:hover { box-shadow:0 2px 6px rgba(0,0,0,.12) }
    .perm-card img {
      width:100%; height:80px; object-fit:contain;
      border:1px solid #ddd; border-radius:4px; background:#fafafa
    }

    /* Modals */
    .modal-overlay {
      position:fixed; top:0; left:0; width:100%; height:100%;
      background:rgba(0,0,0,.4); display:none;
      justify-content:center; align-items:center; z-index:1000
    }
    .modal {
      background:#fff; border-radius:8px; padding:1.5rem;
      width:90%; max-width:420px; position:relative;
      box-shadow:0 2px 12px rgba(0,0,0,.2)
    }
    .modal .close-modal {
      position:absolute; top:.5rem; right:.75rem;
      background:none; border:none; font-size:1.25rem; cursor:pointer;
      transition:.2s
    }
    .modal .close-modal:hover { color:#900 }

    /* Autocomplete */
    #daily-sign-suggestions {
      position:absolute; top:100%; left:0; right:0; background:#fff;
      border:1px solid #ccc; border-top:none; border-radius:0 0 5px 5px;
      max-height:240px; overflow-y:auto; z-index:10; box-shadow:0 2px 8px rgba(0,0,0,0.1);
    }
    .suggestion-item {
      padding:.5rem; display:flex; align-items:center; cursor:pointer;
      transition:.2s; border-bottom:1px solid #f0f0f0;
    }
    .suggestion-item:hover,
    .suggestion-item.active { 
      background:#e3f2fd; 
    }
    .suggestion-item:last-child {
      border-bottom:none;
    }
    .suggestion-item img {
      width:30px; height:30px; object-fit:cover; margin-right:.5rem;
      border:1px solid #ddd; border-radius:4px; flex-shrink:0;
    }

    /* Notification styles */
    .notification {
      position:fixed; top:20px; right:20px; z-index:1001;
      background:#28a745; color:#fff; padding:1rem 1.5rem;
      border-radius:8px; box-shadow:0 4px 12px rgba(0,0,0,.2);
      transform:translateX(100%); transition:transform .3s;
    }
    .notification.show { transform:translateX(0) }
    .notification.warning {
      background:#ffc107; color:#212529;
    }

    /* Dismissible banner styles */
    .info-banner {
      background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
      border: 1px solid #90caf9;
      border-radius: 8px;
      padding: 1rem;
      margin-bottom: 1rem;
      font-size: 0.9rem;
      color: #1565c0;
      position: relative;
      display: block;
      transition: all 0.3s ease;
    }
    .info-banner.hidden {
      display: none;
    }
    .info-banner strong {
      color: #0d47a1;
    }
    .info-banner .close-banner {
      position: absolute;
      top: 0.5rem;
      right: 0.75rem;
      background: none;
      border: none;
      font-size: 1.2rem;
      cursor: pointer;
      color: #1565c0;
      transition: color 0.2s;
    }
    .info-banner .close-banner:hover {
      color: #0d47a1;
    }

    /* File upload styles */
    .file-upload-area {
      border: 2px dashed #005a9c;
      border-radius: 8px;
      padding: 2rem;
      text-align: center;
      background: #f8f9fa;
      margin: 1rem 0;
      transition: all 0.3s ease;
    }
    .file-upload-area:hover {
      background: #e9ecef;
      border-color: #00417c;
    }
    .file-upload-area.dragover {
      background: #e3f2fd;
      border-color: #1976d2;
    }
    .file-input {
      display: none;
    }

    /* Import/Export section */
    .import-export-section {
      background: #fff;
      border: 1px solid #dee2e6;
      border-radius: 8px;
      padding: 1.5rem;
      margin: 1rem 0;
    }
    .import-export-section h3 {
      margin-bottom: 1rem;
      color: #00345b;
      border-bottom: 2px solid #e1eaf8;
      padding-bottom: 0.5rem;
    }
    .button-group {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }
    
    /* Sign count badge */
    .sign-count {
      background: #005a9c;
      color: white;
      padding: 0.5rem 1rem;
      border-radius: 20px;
      font-weight: 500;
      white-space: nowrap;
    }
  </style>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  
  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { getFirestore, collection, addDoc, updateDoc, deleteDoc, doc, onSnapshot, query, orderBy } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
    import { getStorage, ref, uploadBytes, getDownloadURL } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js';
    
    // 🔥 FIREBASE CONFIGURATION - YOUR PROJECT DETAILS 🔥
    const firebaseConfig = {
      apiKey: "AIzaSyDTvH8VeU30Py44eiZzOFZyisNB59gDMW4",
      authDomain: "constructionsigndiaries.firebaseapp.com",
      projectId: "constructionsigndiaries",
      storageBucket: "constructionsigndiaries.firebasestorage.app",
      messagingSenderId: "101801431075",
      appId: "1:101801431075:web:c0f3b0ccaf1134a75f6196",
      measurementId: "G-PC5MTYLEV0"
    };
    
    // Initialize Firebase
    try {
      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);
      const storage = getStorage(app);
      
      // Make Firebase available globally
      window.firebaseDb = db;
      window.firebaseStorage = storage;
      window.firebaseUtils = {
        collection, addDoc, updateDoc, deleteDoc, doc, onSnapshot, query, orderBy,
        ref, uploadBytes, getDownloadURL
      };
      
      console.log('✅ Firebase initialized successfully');
    } catch (error) {
      console.error('❌ Firebase initialization failed:', error);
      
      // Show detailed setup instructions on config error
      setTimeout(() => {
        const statusElement = document.getElementById('current-file-status');
        if (statusElement) {
          statusElement.innerHTML = `<span style="color:#d00">⚠️ Firebase not configured</span>`;
        }
        
        // Show setup banner
        const banner = document.getElementById('file-banner');
        if (banner) {
          banner.style.background = '#fff3cd';
          banner.style.borderColor = '#ffeaa7';
          banner.innerHTML = `
            <strong>🔧 Setup Required:</strong> 
            Firebase configuration not found. 
            <a href="#setup-instructions" onclick="showSetupInstructions()" style="color:#856404;text-decoration:underline">Click here for setup instructions</a>
          `;
        }
      }, 1000);
    }
  </script>
</head>
<body>

  <!-- Sidebar -->
  <div id="sidebar">
    <h2>Menu</h2>
    <nav>
      <button id="nav-library" class="active">1. Sign Library</button>
      <button id="nav-routes">2. Permanent Routes</button>
      <button id="nav-inspections">3. Inspections</button>
      <button id="nav-traffic-plans">4. Traffic Control Plans</button>
      <button id="nav-reports">5. Reports</button>
    </nav>
  </div>

  <!-- Main -->
  <div id="main">
    <!-- File Management Banner -->
    <div id="file-banner" class="info-banner">
      <button class="close-banner" id="dismiss-banner-btn">&times;</button>
      <strong>☁️ Cloud-Powered:</strong> This app uses Firebase for real-time data sync. Your signs, routes, and inspection reports are stored in the cloud and automatically sync across devices.
      <span id="current-file-status">Connecting to Firebase...</span>
    </div>

    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem">
      <button id="toggle-sidebar">☰ Menu</button>
      <button id="quit-app-btn" style="background:#dc3545;color:#fff;border:none;padding:.5rem 1rem;border-radius:4px;cursor:pointer;transition:.2s">
        ⚡ Quit App
      </button>
    </div>

    <!-- Section 1: Sign Library -->
    <section id="section-library" class="section active">
      <h1>1. Sign Library</h1>
      
      <!-- Status Banner -->
      <div id="signs-status-banner" class="info-banner">
        <button class="close-banner" id="dismiss-signs-banner-btn">&times;</button>
        <strong>🔄 Real-Time Sync:</strong> <span id="current-file-status">Connecting to Firebase...</span>
      </div>

      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem;gap:1rem">
        <input type="text" id="sign-search" placeholder="Loading signs..." style="flex:1" disabled/>
        <button id="open-add-sign-btn" class="btn">Add New Sign</button>
        <div class="sign-count" style="background:#005a9c;color:#fff;padding:0.5rem 1rem;border-radius:20px;font-weight:500">
          📋 <span id="sign-count">0</span> signs
        </div>
      </div>
      <div id="sign-list" class="item-list"></div>
    </section>

    <!-- Section 2: Permanent Routes -->
    <section id="section-routes" class="section">
      <h1>2. Permanent Routes</h1>
      <h2>Create / Edit Route</h2>
      <form id="route-form" style="background:#fff;padding:1rem;border-radius:8px;box-shadow:0 1px 4px rgba(0,0,0,.1)">
        <div class="form-group">
          <label for="route-name">Route Name</label>
          <input type="text" id="route-name" name="route-name" required placeholder="Job #1234 - Highway Work"/>
        </div>
        
        <div style="margin-bottom:1rem">
          <h3 style="color:#00345b;margin-bottom:0.5rem">Route Entries</h3>
          <p style="color:#666;font-size:0.9rem;margin-bottom:1rem">Add the permanent signs for this route in order from start to finish.</p>
        </div>
        
        <table style="margin-bottom:1rem">
          <thead><tr>
            <th>Sign</th><th>Station</th><th>Highway</th><th>End Station</th><th>Remove</th>
          </tr></thead>
          <tbody id="route-entries-body"></tbody>
        </table>
        
        <div style="display:flex;gap:0.5rem;flex-wrap:wrap">
          <button id="add-route-entry-btn" class="btn secondary" type="button">+ Add Sign Entry</button>
          <button type="submit" class="btn">Save Route</button>
          <button type="button" id="cancel-route-btn" class="btn" style="background:#6c757d" onclick="clearRouteForm()">Cancel</button>
        </div>
      </form>
      <hr style="margin:2rem 0;border-color:#ddd"/>
      <h2>Existing Routes</h2>
      <div id="route-list" class="item-list"></div>
    </section>

    <!-- Section 3: Inspections -->
    <section id="section-inspections" class="section">
      <h1>3. Inspections</h1>

      <!-- Permanent Diary -->
      <section style="background:#fff;padding:1rem;border-radius:8px;box-shadow:0 1px 4px rgba(0,0,0,.1);margin-bottom:2rem">
        <h2>Permanent Diary</h2>
        <div id="perm-select-div">
          <div class="form-group">
            <label for="perm-route-select">Select a Route</label>
            <select id="perm-route-select"><option value="">-- Select --</option></select>
          </div>
          <button id="start-perm-inspection-btn" class="btn" type="button" disabled>Start Inspection</button>
        </div>
        <div id="perm-inspect-div" style="display:none;margin-top:1rem">
          <h3 id="perm-inspect-title"></h3>
          <div id="perm-grid"></div>
          <button id="save-permanent-btn" class="btn" type="button" style="margin-top:1rem">
            Finish & Download Permanent PDF
          </button>
        </div>
      </section>

      <!-- Daily Diary -->
      <section style="background:#fff;padding:1rem;border-radius:8px;box-shadow:0 1px 4px rgba(0,0,0,.1);position:relative">
        <h2>Daily‐Changing Diary</h2>
        <form id="daily-entry-form" style="margin-bottom:1rem">
          <div style="display:flex;gap:1rem">
            <div class="form-group" style="flex:2;position:relative">
              <label for="daily-sign-search">Sign Type</label>
              <input type="text" id="daily-sign-search" placeholder="Searching for JSON files..." autocomplete="off" disabled/>
              <input type="hidden" id="daily-sign-id"/>
              <div id="daily-sign-suggestions" style="display:none"></div>
            </div>
            <div class="form-group" style="flex:1">
              <label for="daily-station">Station</label>
              <input type="text" id="daily-station" placeholder="10+100.00" maxlength="9"/>
            </div>
            <div class="form-group" style="flex:1">
              <label for="daily-highway">Highway</label>
              <input type="text" id="daily-highway" placeholder="e.g., HWY 401 E"/>
            </div>
          </div>
          <div style="display:flex;gap:0.5rem">
            <button id="add-daily-entry-btn" class="btn" type="button" disabled>+ Select Sign First</button>
            <button id="reload-last-diary-btn" class="btn secondary" type="button">📋 Reload Last Diary</button>
          </div>
        </form>
        <table>
          <thead><tr><th>Image</th><th>Name</th><th>Station</th><th>Highway</th><th>Actions</th></tr></thead>
          <tbody id="daily-diary-body"></tbody>
        </table>
        <button id="save-daily-btn" class="btn" type="button">Finish & Download Daily PDF</button>

        <h2 style="margin-top:2rem">Past Inspections</h2>
        <div id="inspection-list" class="item-list"></div>
      </section>
    </section>

    <!-- Section 4: Traffic Control Plans -->
    <section id="section-traffic-plans" class="section">
      <h1>4. Traffic Control Plans</h1>
      
      <!-- TS-15 Form -->
      <section style="background:#fff;padding:1.5rem;border-radius:8px;box-shadow:0 1px 4px rgba(0,0,0,.1);margin-bottom:2rem">
        <h2>TS-15: Lane Closed or Occupied (Traffic Control Persons)</h2>
        <p style="color:#666;margin-bottom:1rem">Reference the official Ontario Traffic Manual document below and fill in station values for your traffic control setup.</p>
        
        <!-- PDF Reference and Form in side-by-side layout -->
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:2rem;margin-bottom:2rem">
          
          <!-- Left: PDF Reference -->
          <div>
            <h3 style="margin-bottom:1rem;color:#00345b">Ontario Traffic Manual Reference</h3>
            <div style="border:2px solid #dee2e6;border-radius:8px;background:#f8f9fa;height:600px;overflow:hidden;position:relative">
              <!-- PDF Embed placeholder -->
              <div style="width:100%;height:100%;background:url('data:image/svg+xml,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 800 600\"><rect width=\"800\" height=\"600\" fill=\"%23f8f9fa\"/><text x=\"400\" y=\"50\" text-anchor=\"middle\" font-family=\"Arial\" font-size=\"16\" font-weight=\"bold\" fill=\"%23000\">ONTARIO TRAFFIC MANUAL · BOOK 7 - APRIL 2022</text><text x=\"400\" y=\"80\" text-anchor=\"middle\" font-family=\"Arial\" font-size=\"14\" fill=\"%23666\">TS-15: Lane Closed or Occupied (Traffic Control Persons)</text><rect x=\"50\" y=\"100\" width=\"700\" height=\"450\" fill=\"%23fff\" stroke=\"%23ccc\" stroke-width=\"2\"/><text x=\"400\" y=\"130\" text-anchor=\"middle\" font-family=\"Arial\" font-size=\"12\" fill=\"%23333\">Reference Diagram Shows:</text><text x=\"70\" y=\"160\" font-family=\"Arial\" font-size=\"11\" fill=\"%23333\">• Sign placement positions and distances</text><text x=\"70\" y=\"180\" font-family=\"Arial\" font-size=\"11\" fill=\"%23333\">• Traffic control person locations</text><text x=\"70\" y=\"200\" font-family=\"Arial\" font-size=\"11\" fill=\"%23333\">• Lane closure taper requirements</text><text x=\"70\" y=\"220\" font-family=\"Arial\" font-size=\"11\" fill=\"%23333\">• Work zone setup standards</text><rect x=\"300\" y=\"250\" width=\"200\" height=\"100\" fill=\"%23ff6b6b\" stroke=\"%23d63031\" stroke-width=\"2\"/><text x=\"400\" y=\"290\" text-anchor=\"middle\" font-family=\"Arial\" font-size=\"12\" font-weight=\"bold\" fill=\"%23fff\">WORK AREA</text><text x=\"400\" y=\"310\" text-anchor=\"middle\" font-family=\"Arial\" font-size=\"10\" fill=\"%23fff\">Lane Closed/Occupied</text><circle cx=\"150\" cy=\"180\" r=\"20\" fill=\"%23ffa500\" stroke=\"%23ff8c00\" stroke-width=\"2\"/><text x=\"150\" y=\"185\" text-anchor=\"middle\" font-family=\"Arial\" font-size=\"8\" font-weight=\"bold\">TC-2B</text><circle cx=\"150\" cy=\"220\" r=\"20\" fill=\"%23ffa500\" stroke=\"%23ff8c00\" stroke-width=\"2\"/><text x=\"150\" y=\"225\" text-anchor=\"middle\" font-family=\"Arial\" font-size=\"8\" font-weight=\"bold\">TC-21</text><circle cx=\"150\" cy=\"260\" r=\"20\" fill=\"%23ffeb3b\" stroke=\"%23ffc107\" stroke-width=\"2\"/><text x=\"150\" y=\"265\" text-anchor=\"middle\" font-family=\"Arial\" font-size=\"8\" font-weight=\"bold\">TC-22</text><circle cx=\"550\" cy=\"200\" r=\"20\" fill=\"%23ffa500\" stroke=\"%23ff8c00\" stroke-width=\"2\"/><text x=\"550\" y=\"205\" text-anchor=\"middle\" font-family=\"Arial\" font-size=\"8\" font-weight=\"bold\">TC-4</text><text x=\"400\" y=\"500\" text-anchor=\"middle\" font-family=\"Arial\" font-size=\"10\" fill=\"%23666\">Click \"View Full PDF\" below to see complete details</text></svg>') center/contain no-repeat">
              </div>
              <button onclick="window.open('#','_blank')" style="position:absolute;bottom:10px;right:10px;background:#00345b;color:white;border:none;padding:8px 16px;border-radius:4px;cursor:pointer;font-size:12px">
                View Full PDF
              </button>
            </div>
          </div>
          
          <!-- Right: Station Input Form -->
          <div>
            <h3 style="margin-bottom:1rem;color:#00345b">Station Values</h3>
            <form id="ts15-form">
              
              <div class="form-group">
                <label for="work-area-start" title="Starting station of the work area" style="border-left: 4px solid #28A745; padding-left: 8px;">Work Area Start Station:</label>
                <input type="text" id="work-area-start" placeholder="10+000.00" maxlength="9"/>
              </div>
              
              <div class="form-group">
                <label for="sign-tc2b" title="Station for first advance warning sign (TC-2B or TC-2A)" style="border-left: 4px solid #FFA500; padding-left: 8px;">TC-2B/TC-2A Station:</label>
                <input type="text" id="sign-tc2b" placeholder="10+000.00" maxlength="9"/>
              </div>
              
              <div class="form-group">
                <label for="sign-rb31" title="Station for regulatory speed sign (if NPRS 70+ km/h)" style="border-left: 4px solid #DC3545; padding-left: 8px;">Rb-31 Station (if applicable):</label>
                <input type="text" id="sign-rb31" placeholder="10+000.00" maxlength="9"/>
              </div>
              
              <div class="form-group">
                <label for="sign-tc21" title="Station for construction ahead sign" style="border-left: 4px solid #FFA500; padding-left: 8px;">TC-21 Station:</label>
                <input type="text" id="sign-tc21" placeholder="10+000.00" maxlength="9"/>
              </div>
              
              <div class="form-group">
                <label for="sign-tc22" title="Station for flagperson ahead sign with SLOW paddle" style="border-left: 4px solid #FFEB3B; padding-left: 8px;">TC-22 Station:</label>
                <input type="text" id="sign-tc22" placeholder="10+000.00" maxlength="9"/>
              </div>
              
              <div class="form-group">
                <label for="tcp-taper-start" title="Starting station of TCP taper" style="border-left: 4px solid #6C757D; padding-left: 8px;">TCP Taper Start:</label>
                <input type="text" id="tcp-taper-start" placeholder="10+000.00" maxlength="9"/>
              </div>
              
              <div class="form-group">
                <label for="sign-tc4" title="Station for lane ends sign" style="border-left: 4px solid #FFA500; padding-left: 8px;">TC-4 Station:</label>
                <input type="text" id="sign-tc4" placeholder="10+000.00" maxlength="9"/>
              </div>
              
              <!-- Project Information -->
              <hr style="margin:1.5rem 0;border-color:#ddd"/>
              <h4 style="margin-bottom:1rem;color:#00345b">Project Information</h4>
              
              <div class="form-group">
                <label for="highway-name">Highway:</label>
                <input type="text" id="highway-name" placeholder="e.g., HWY 401 E"/>
              </div>
              
              <div class="form-group">
                <label for="project-date">Date:</label>
                <input type="date" id="project-date"/>
              </div>
              
              <div class="form-group">
                <label for="inspector-name">Inspector Name:</label>
                <input type="text" id="inspector-name" placeholder="Full Name"/>
              </div>
              
              <div style="margin-top:2rem">
                <button type="button" id="generate-ts15-btn" class="btn">Generate TS-15 PDF</button>
                <button type="button" id="preview-ts15-btn" class="btn" style="background:#666;margin-left:0.5rem">Preview Layout</button>
              </div>
            </form>
          </div>
        </div>
        
        <!-- Preview Area -->
        <div id="ts15-preview" style="display:none;margin-top:2rem;padding:1rem;background:#f8f9fa;border-radius:8px">
          <h3 style="color:#00345b;margin-bottom:1rem">Layout Preview</h3>
          <div style="font-family:monospace;font-size:0.8rem;color:#333">
            <div style="margin-bottom:0.5rem"><strong>Work Zone Setup:</strong></div>
            <div id="preview-content">
              <!-- Preview content will be generated here -->
            </div>
          </div>
        </div>
      </section>
      
      <!-- Past Plans -->
      <section style="background:#fff;padding:1rem;border-radius:8px;box-shadow:0 1px 4px rgba(0,0,0,.1)">
        <h2>Generated Traffic Control Plans</h2>
        <div id="traffic-plans-list" class="item-list">
          <div style="padding:.6rem;color:#666">No plans generated yet.</div>
        </div>
      </section>
    </section>

    <!-- Section 5: Reports -->
    <section id="section-reports" class="section">
      <h1>5. Reports</h1>
      <p style="color:#666">(Weekly flows…)</p>
    </section>
  </div>

  <!-- Add/Edit Sign Modal -->
  <div id="add-sign-modal" class="modal-overlay">
    <div class="modal">
      <button id="close-add-sign-btn" class="close-modal">&times;</button>
      <h2 id="modal-title">Add New Sign</h2>
      <form id="add-sign-form">
        <div class="form-group">
          <label for="modal-sign-name">Technical Name</label>
          <input type="text" id="modal-sign-name" required placeholder="e.g., TC-21"/>
        </div>
        <div class="form-group">
          <label for="modal-sign-common">Common Name</label>
          <input type="text" id="modal-sign-common" required placeholder="e.g., Construction Ahead"/>
        </div>
        <div class="form-group">
          <label for="modal-sign-image">Sign Image (Optional)</label>
          <input type="file" id="modal-sign-image" accept="image/*"/>
          <small style="color:#666;font-size:0.8rem">Leave empty to use image from ./images/ folder</small>
        </div>
        <div class="form-group" style="text-align:center">
          <label>Preview:</label><br/>
          <img id="sign-preview" src="" alt="Preview" style="max-width:100px;max-height:100px;border:1px solid #ccc"/>
        </div>
        <div style="text-align:right">
          <button id="cancel-add-sign-btn" class="btn secondary" type="button">Cancel</button>
          <button id="save-sign-btn" class="btn" type="submit">Save to Cloud</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Quit Confirmation Modal -->
  <div id="quit-modal" class="modal-overlay">
    <div class="modal">
      <h2 style="color:#dc3545;margin-bottom:1rem">⚡ Quit Application</h2>
      <p style="margin-bottom:1rem">Are you sure you want to quit the Construction Sign Diaries application?</p>
      <p style="font-size:0.9rem;color:#666;margin-bottom:1.5rem">
        This will attempt to shutdown any local server and close the application.
      </p>
      <div style="text-align:right">
        <button id="cancel-quit-btn" class="btn secondary" style="margin-right:0.5rem">Cancel</button>
        <button id="confirm-quit-btn" class="btn" style="background:#dc3545">Quit Application</button>
      </div>
    </div>
  </div>

  <!-- JavaScript (Application Logic) -->
  <script>
  document.addEventListener('DOMContentLoaded', ()=> {
    // Wait for Firebase to be available
    setTimeout(initializeApp, 100);
    
    function initializeApp() {
      if (!window.firebaseDb) {
        console.log('Waiting for Firebase...');
        setTimeout(initializeApp, 100);
        return;
      }
      
      console.log('Firebase initialized, starting app...');
      startApplication();
    }
    
    function startApplication() {
    // Check if banner was previously dismissed
    if (localStorage.getItem('bannerDismissed') === 'true') {
      document.getElementById('file-banner').classList.add('hidden');
    }
    if (localStorage.getItem('signsBannerDismissed') === 'true') {
      document.getElementById('signs-status-banner').classList.add('hidden');
    }

    // Banner dismiss functionality
    document.getElementById('dismiss-banner-btn').onclick = function() {
      const banner = document.getElementById('file-banner');
      banner.classList.add('hidden');
      localStorage.setItem('bannerDismissed', 'true');
    };
    
    document.getElementById('dismiss-signs-banner-btn').onclick = function() {
      const banner = document.getElementById('signs-status-banner');
      banner.classList.add('hidden');
      localStorage.setItem('signsBannerDismissed', 'true');
    };

    // Utility functions
    const stationRegex=/^\d{2}\+\d{3}\.\d{2}$/,
          placeholderImage='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><rect width="100" height="100" fill="%23f0f0f0"/><text x="50" y="50" text-anchor="middle" dy=".3em" font-family="Arial" font-size="12" fill="%23999">No Image</text></svg>';
    
    function uuid(){ return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,c=>{ const r=Math.random()*16|0, v=c==='x'?r:(r&0x3|0x8); return v.toString(16); });}

    // Data variables - simplified for signs-only loading
    let signs = [];
    let routes = [], permLogs = [], dailyLogs = [], trafficPlans = [];
    let dailyEntries = [], permEntries = [];
    
    // Daily search state
    let dailySearchSuggestions = [];
    let selectedSuggestionIndex = -1;

    // Firebase-backed signs loading with real-time updates
    function setupFirebaseSignsListener() {
      const statusElement = document.getElementById('current-file-status');
      
      try {
        console.log('🔍 Setting up Firebase signs listener...');
        statusElement.textContent = 'Connecting to Firebase...';
        
        const { collection, onSnapshot, query, orderBy } = window.firebaseUtils;
        const signsCollection = collection(window.firebaseDb, 'signs');
        const signsQuery = query(signsCollection, orderBy('name'));
        
        // Set up real-time listener
        const unsubscribe = onSnapshot(signsQuery, (snapshot) => {
          signs = [];
          
          snapshot.forEach((doc) => {
            const signData = doc.data();
            signs.push({
              id: doc.id,
              name: signData.name,
              commonName: signData.commonName,
              imageData: signData.imageData || buildImageUrl(signData.name)
            });
          });
          
          console.log(`✅ Loaded ${signs.length} signs from Firebase`);
          
          // If no signs exist, offer to create sample data
          if (signs.length === 0) {
            statusElement.innerHTML = `
              <span style="color:#e67e22">No signs in database. </span>
              <button onclick="createSampleSignsInFirebase()" style="background:#28a745;color:white;border:none;padding:0.25rem 0.5rem;border-radius:3px;cursor:pointer;margin:0 0.25rem">🌱 Create Sample Signs</button>
            `;
          } else {
            statusElement.textContent = `Connected to Firebase - ${signs.length} signs loaded`;
          }
          
          updateSearchInput();
          renderSigns();
          renderRouteSelect();
          
          // Initialize daily search with loaded signs
          setTimeout(() => {
            initializeDailySearch();
          }, 100);
        }, (error) => {
          console.error('❌ Firebase listener error:', error);
          statusElement.textContent = `Firebase connection error: ${error.message}`;
          
          // Show detailed error help
          document.getElementById('sign-list').innerHTML = `
            <div style="padding:1rem;color:#d00;text-align:center;background:#ffebee;border-radius:8px">
              <strong>⚠️ Firebase Connection Error</strong><br>
              <code>${error.message}</code><br><br>
              <strong>Common fixes:</strong><br>
              • Check your Firebase config in the code<br>
              • Ensure Firestore is enabled in Firebase Console<br>
              • Check browser console for more details<br>
              <button onclick="window.location.reload()" style="margin-top:0.5rem;padding:0.5rem;background:#005a9c;color:white;border:none;border-radius:3px;cursor:pointer">🔄 Retry Connection</button>
            </div>
          `;
          
          // Disable search
          const searchInput = document.getElementById('sign-search');
          searchInput.placeholder = 'Firebase connection failed';
          searchInput.disabled = true;
        });
        
        // Store unsubscribe function for cleanup if needed
        window.firebaseUnsubscribe = unsubscribe;
        
      } catch (error) {
        console.error('❌ Failed to setup Firebase listener:', error);
        statusElement.innerHTML = `
          <span style="color:#d00">Firebase setup error: ${error.message}</span><br>
          <small>Check that your Firebase config is correct</small>
        `;
      }
    }
    
    // Helper function to create sample signs in Firebase (for first-time setup)
    async function createSampleSignsInFirebase() {
      try {
        console.log('🌱 Creating sample signs in Firebase...');
        
        const sampleSigns = [
          { name: 'TC-1', commonName: 'Road Work Ahead' },
          { name: 'TC-2A', commonName: 'Construction 800m' },
          { name: 'TC-2B', commonName: 'Construction 400m' },
          { name: 'TC-4', commonName: 'Lane Ends' },
          { name: 'TC-21', commonName: 'Construction Ahead' },
          { name: 'TC-22', commonName: 'Flagperson Ahead' },
          { name: 'Ra-1', commonName: 'Stop' },
          { name: 'Ra-2', commonName: 'Yield' }
        ];
        
        const { collection, addDoc } = window.firebaseUtils;
        const signsCollection = collection(window.firebaseDb, 'signs');
        
        for (const sign of sampleSigns) {
          await addDoc(signsCollection, {
            name: sign.name,
            commonName: sign.commonName,
            created: new Date().toISOString(),
            modified: new Date().toISOString()
          });
        }
        
        console.log('✅ Sample signs created successfully');
        showNotification('✅ Sample signs created! Database is now ready.');
        
      } catch (error) {
        console.error('❌ Error creating sample signs:', error);
        showNotification(`❌ Error creating sample signs: ${error.message}`, 'warning');
      }
    }
    
    // Make function available globally
    window.createSampleSignsInFirebase = createSampleSignsInFirebase;
    
    // Build image URL from GitHub Pages images folder
    function buildImageUrl(technicalName) {
      // For GitHub Pages hosting at: https://og-nater-tater.github.io/mywebiste/signs/
      // Images should be in: https://og-nater-tater.github.io/mywebiste/signs/images/
      const cleanName = technicalName.replace(/[^a-zA-Z0-9\-\_]/g, '');
      return `./images/${cleanName}.jpg`;
    }
    
    // Alternative: if you want to try multiple extensions
    function getImageWithFallback(technicalName) {
      const cleanName = technicalName.replace(/[^a-zA-Z0-9\-\_]/g, '');
      const extensions = ['jpg', 'jpeg', 'png', 'gif', 'webp'];
      
      // For now, default to .jpg - you can enhance this later to check which exists
      return `./images/${cleanName}.jpg`;
    }
    
    // Add new sign to Firebase
    async function addSignToFirebase(signData) {
      try {
        const { collection, addDoc } = window.firebaseUtils;
        const signsCollection = collection(window.firebaseDb, 'signs');
        
        const docRef = await addDoc(signsCollection, {
          name: signData.name,
          commonName: signData.commonName,
          imageData: signData.imageData,
          created: new Date().toISOString(),
          modified: new Date().toISOString()
        });
        
        console.log('✅ Sign added to Firebase:', docRef.id);
        showNotification(`✅ Sign "${signData.name}" saved to cloud!`);
        
      } catch (error) {
        console.error('❌ Error adding sign to Firebase:', error);
        showNotification(`❌ Failed to save sign: ${error.message}`, 'warning');
      }
    }
    
    // Update existing sign in Firebase
    async function updateSignInFirebase(signId, signData) {
      try {
        const { doc, updateDoc } = window.firebaseUtils;
        const signDoc = doc(window.firebaseDb, 'signs', signId);
        
        await updateDoc(signDoc, {
          name: signData.name,
          commonName: signData.commonName,
          imageData: signData.imageData,
          modified: new Date().toISOString()
        });
        
        console.log('✅ Sign updated in Firebase:', signId);
        showNotification(`✅ Sign "${signData.name}" updated in cloud!`);
        
      } catch (error) {
        console.error('❌ Error updating sign in Firebase:', error);
        showNotification(`❌ Failed to update sign: ${error.message}`, 'warning');
      }
    }
    
    // Delete sign from Firebase
    async function deleteSignFromFirebase(signId) {
      try {
        const { doc, deleteDoc } = window.firebaseUtils;
        const signDoc = doc(window.firebaseDb, 'signs', signId);
        
        await deleteDoc(signDoc);
        
        console.log('✅ Sign deleted from Firebase:', signId);
        showNotification(`✅ Sign deleted from cloud!`);
        
      } catch (error) {
        console.error('❌ Error deleting sign from Firebase:', error);
        showNotification(`❌ Failed to delete sign: ${error.message}`, 'warning');
      }
    }

    // Update search input based on loaded signs
    function updateSearchInput() {
      const searchInput = document.getElementById('sign-search');
      
      if (signs.length === 0) {
        searchInput.placeholder = 'No signs available';
        searchInput.disabled = true;
      } else {
        searchInput.placeholder = `Search ${signs.length} signs by name or code (e.g., TC-21, Stop, Construction)...`;
        searchInput.disabled = false;
      }
    }

    // Notification function
    function showNotification(message, type = 'success') {
      const notification = document.createElement('div');
      notification.className = `notification ${type}`;
      notification.textContent = message;
      document.body.appendChild(notification);
      
      setTimeout(() => notification.classList.add('show'), 100);
      setTimeout(() => {
        notification.classList.remove('show');
        setTimeout(() => document.body.removeChild(notification), 300);
      }, 3000);
    }

    // PDF Download Function - saves to GitHub Pages structure
    function downloadPDF(pdfData, signTechnicalName, description = '') {
      try {
        const timestamp = new Date().toISOString().slice(0, 19).replace(/:/g, '-');
        // Name PDF after technical sign name for GitHub Pages structure
        const cleanSignName = signTechnicalName.replace(/[^a-zA-Z0-9\-\_]/g, '');
        const filename = `${cleanSignName}.pdf`;
        
        const byteCharacters = atob(pdfData);
        const byteNumbers = new Array(byteCharacters.length);
        for (let i = 0; i < byteCharacters.length; i++) {
          byteNumbers[i] = byteCharacters.charCodeAt(i);
        }
        const byteArray = new Uint8Array(byteNumbers);
        const blob = new Blob([byteArray], { type: 'application/pdf' });

        const link = document.createElement('a');
        link.href = window.URL.createObjectURL(blob);
        link.download = filename;
        
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        window.URL.revokeObjectURL(link.href);
        
        showNotification(`✅ ${description} downloaded: ${filename}`);
        showNotification(`📁 Upload ${filename} to your GitHub /signs/ folder for access via URL`, 'info');
        
        // Log PDF metadata to Firestore for tracking
        logPDFToFirestore(filename, description, signTechnicalName, timestamp);
        
      } catch (error) {
        console.error('Error downloading PDF:', error);
        showNotification(`❌ Error downloading ${description}: ${error.message}`, 'warning');
      }
    }
    
    // Log PDF metadata to Firestore (for audit trail)
    async function logPDFToFirestore(filename, description, signTechnicalName, timestamp) {
      try {
        const { collection, addDoc } = window.firebaseUtils;
        const pdfsCollection = collection(window.firebaseDb, 'pdf_logs');
        
        const pdfRecord = {
          filename: filename,
          description: description,
          signTechnicalName: signTechnicalName,
          githubUrl: `https://og-nater-tater.github.io/mywebiste/signs/${filename}`,
          created: timestamp,
          type: 'local_download'
        };
        
        await addDoc(pdfsCollection, pdfRecord);
        console.log('✅ PDF metadata logged to Firestore');
        
      } catch (error) {
        console.error('❌ Error logging PDF metadata:', error);
        // Don't show error to user - this is just for tracking
      }
    }
    
    // Helper to build PDF URL for YOUR exact GitHub location
    function buildPDFUrl(signTechnicalName) {
      const cleanName = signTechnicalName.replace(/[^a-zA-Z0-9\-\_]/g, '');
      
      // Your EXACT GitHub Pages structure:
      // Repository: https://github.com/og-nater-tater/mywebiste/tree/52aa664608fa5a456ed7b5fef1e0604dae3aac60/signs
      // GitHub Pages: https://og-nater-tater.github.io/mywebiste/signs/
      return `https://og-nater-tater.github.io/mywebiste/signs/${cleanName}.pdf`;
    }
    
    // Helper to check if PDF exists on YOUR exact GitHub Pages location
    async function checkPDFExists(signTechnicalName) {
      try {
        const pdfUrl = buildPDFUrl(signTechnicalName);
        console.log(`🔍 Checking PDF at exact location: ${pdfUrl}`);
        const response = await fetch(pdfUrl, { method: 'HEAD' });
        return response.ok;
      } catch (error) {
        console.log(`❌ Error checking PDF: ${error.message}`);
        return false;
      }
    }
    
    // Helper to open existing PDF from YOUR GitHub Pages
    function openExistingPDF(signTechnicalName) {
      const pdfUrl = buildPDFUrl(signTechnicalName);
      console.log(`📄 Opening PDF: ${pdfUrl}`);
      console.log(`📁 Full URL: https://og-nater-tater.github.io/mywebiste/signs/${signTechnicalName}.pdf`);
      window.open(pdfUrl, '_blank');
      showNotification(`📄 Opening ${signTechnicalName}.pdf from /signs/ folder`);
    }

    // Navigation
    function setActive(sec,btn){
      document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
      document.getElementById(sec).classList.add('active');
      document.querySelectorAll('#sidebar nav button').forEach(b=>b.classList.remove('active'));
      document.getElementById(btn).classList.add('active');
    }
    
    document.getElementById('nav-library').onclick=()=>setActive('section-library','nav-library');
    document.getElementById('nav-routes').onclick=()=>setActive('section-routes','nav-routes');
    document.getElementById('nav-inspections').onclick=()=>setActive('section-inspections','nav-inspections');
    document.getElementById('nav-traffic-plans').onclick=()=>setActive('section-traffic-plans','nav-traffic-plans');
    document.getElementById('nav-reports').onclick=()=>setActive('section-reports','nav-reports');
    document.getElementById('toggle-sidebar').onclick=()=>document.body.classList.toggle('sidebar-collapsed');

    // Quit application functionality
    document.getElementById('quit-app-btn').onclick = () => {
      document.getElementById('quit-modal').style.display = 'flex';
    };

    document.getElementById('cancel-quit-btn').onclick = () => {
      document.getElementById('quit-modal').style.display = 'none';
    };

    document.getElementById('quit-modal').onclick = (e) => {
      if (e.target === document.getElementById('quit-modal')) {
        document.getElementById('quit-modal').style.display = 'none';
      }
    };

    document.getElementById('confirm-quit-btn').onclick = async () => {
      if (hasUnsavedChanges && !confirm('You have unsaved changes. Quit anyway?')) {
        return;
      }
      
      document.getElementById('quit-modal').style.display = 'none';
      
      const quitBtn = document.getElementById('quit-app-btn');
      const originalText = quitBtn.innerHTML;
      quitBtn.innerHTML = '⏳ Shutting down...';
      quitBtn.disabled = true;

      let serverShutdown = false;
      
      const shutdownEndpoints = ['/shutdown', '/quit', '/stop', '/__shutdown__'];

      for (const endpoint of shutdownEndpoints) {
        try {
          const response = await fetch(endpoint, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ action: 'shutdown' })
          });
          
          if (response.ok) {
            serverShutdown = true;
            break;
          }
        } catch (e) {
          continue;
        }
      }

      if (serverShutdown) {
        alert('✅ Local server shutdown successful!\n\nThe application has been closed. You can now close this browser window.');
      } else {
        const isLocalhost = window.location.hostname === 'localhost' || 
                           window.location.hostname === '127.0.0.1' || 
                           window.location.hostname === '';
        
        if (isLocalhost) {
          alert('⚠️ Could not automatically shutdown the local server.\n\nTo fully quit the application:\n\n1. Close this browser window\n2. In your terminal/command prompt, press Ctrl+C to stop the server\n\nOr check your server documentation for the proper shutdown command.');
        } else {
          alert('✅ Application session ended.\n\nYou can now close this browser window.');
        }
      }

      try {
        window.close();
      } catch (e) {
        console.log('Could not automatically close window');
      }
      
      setTimeout(() => {
        window.location.href = 'about:blank';
      }, 1000);

      quitBtn.innerHTML = originalText;
      quitBtn.disabled = false;
    };

    // Sign Library Search - Firebase-backed with CRUD operations and PDF links
    function renderSigns(){
      const container=document.getElementById('sign-list'),
            q=document.getElementById('sign-search').value.toLowerCase();
      container.innerHTML='';
      
      // Update count
      document.getElementById('sign-count').textContent = signs.length;
      
      // Handle loading state
      if (signs.length === 0) {
        container.innerHTML='<div style="padding:.6rem;color:#666;text-align:center">📂 No signs in database. <button onclick="openSignModal()" style="color:#005a9c;background:none;border:none;cursor:pointer;text-decoration:underline">Add your first sign</button></div>';
        return;
      }
      
      // Filter signs based on search
      const filtered = signs.filter(s => {
        const searchText = (s.name + ' ' + s.commonName).toLowerCase();
        return searchText.includes(q);
      });
      
      // Handle no search results
      if(!filtered.length){
        if(q.trim()) {
          container.innerHTML=`<div style="padding:.6rem;color:#666;text-align:center">No signs found matching "${q}". <button onclick="document.getElementById('sign-search').value=''; renderSigns();" style="color:#005a9c;background:none;border:none;cursor:pointer;text-decoration:underline">Clear search</button></div>`;
        } else {
          container.innerHTML='<div style="padding:.6rem;color:#666;text-align:center">No signs found.</div>';
        }
        return;
      }
      
      // Render filtered signs with edit/delete buttons and PDF links
      filtered.forEach(s=>{
        const d=document.createElement('div');
        d.innerHTML=`
          <div style="display:flex;align-items:center;gap:1rem;flex:1">
            <img src="${s.imageData}" style="width:40px;height:40px;object-fit:cover;border:1px solid #ccc;border-radius:4px"/>
            <span style="flex:1;color:#00345b"><strong>${s.name}</strong></span>
            <span style="flex:1;color:#00345b">${s.commonName}</span>
          </div>
          <div style="display:flex;gap:0.5rem;align-items:center">
            <button onclick="openPDFForSign('${s.name}')" title="Open/Check PDF" style="background:none;border:none;color:#28a745;cursor:pointer;font-size:0.9rem">📄</button>
            <button class="edit-sign" data-id="${s.id}" title="Edit sign" style="background:none;border:none;color:#005a9c;cursor:pointer;margin-right:0.5rem">✎</button>
            <button class="delete-sign" data-id="${s.id}" title="Delete sign" style="background:none;border:none;color:#d00;cursor:pointer">×</button>
          </div>`;
        
        d.querySelector('.edit-sign').onclick=()=>openSignModal(s);
        d.querySelector('.delete-sign').onclick=async ()=>{
          if(confirm(`Delete "${s.commonName}"? This will remove it from the cloud database.`)){
            await deleteSignFromFirebase(s.id);
          }
        };
        container.append(d);
      });
      
      // Add search result summary if searching
      if(q.trim() && filtered.length > 0) {
        const summary = document.createElement('div');
        summary.style.cssText = 'padding:0.5rem 1rem;background:#e3f2fd;border-bottom:1px solid #90caf9;font-size:0.85rem;color:#1565c0;text-align:center';
        summary.innerHTML = `Found ${filtered.length} of ${signs.length} signs matching "${q}" <button onclick="document.getElementById('sign-search').value=''; renderSigns();" style="color:#1565c0;background:none;border:none;cursor:pointer;text-decoration:underline;margin-left:0.5rem">Clear</button>`;
        container.insertBefore(summary, container.firstChild);
      }
    }
    
    // Open PDF for a specific sign from YOUR GitHub structure
    async function openPDFForSign(signTechnicalName) {
      const pdfExists = await checkPDFExists(signTechnicalName);
      
      if (pdfExists) {
        openExistingPDF(signTechnicalName);
      } else {
        const expectedUrl = `https://og-nater-tater.github.io/mywebiste/signs/${signTechnicalName}.pdf`;
        const message = `PDF not found for ${signTechnicalName}

Expected location: ${expectedUrl}

To add this PDF to YOUR GitHub repository:
1. Create/generate the PDF for this sign
2. Name it exactly: ${signTechnicalName}.pdf
3. Upload it to: /signs/ folder in your repo
4. Your repo structure should be:
   /mywebiste/
   ├── sign-daily.html     ← Your app
   └── /signs/
       └── ${signTechnicalName}.pdf ← HERE

5. Commit changes and wait 2-3 minutes for GitHub Pages to update

Would you like to open the expected URL anyway to check?`;
        
        if (confirm(message)) {
          openExistingPDF(signTechnicalName);
        }
      }
    }
    
    // Make function globally available
    window.openPDFForSign = openPDFForSign;
    
    // Enhanced search input handling
    document.getElementById('sign-search').addEventListener('input', function() {
      // Debounce search for better performance with large libraries
      clearTimeout(this.searchTimeout);
      this.searchTimeout = setTimeout(() => {
        renderSigns();
      }, 150);
    });
    
    // Clear search on escape key
    document.getElementById('sign-search').addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        this.value = '';
        renderSigns();
      }
    });

    // Sign Modal with Firebase integration
    const modal=document.getElementById('add-sign-modal'),
          form=document.getElementById('add-sign-form'),
          prev=document.getElementById('sign-preview'),
          imgIn=document.getElementById('modal-sign-image');
    let editingSign=null;
    
    function openSignModal(s){
      editingSign=s||null;
      document.getElementById('modal-title').textContent=s?'Edit Sign':'Add New Sign';
      document.getElementById('modal-sign-name').value=s?s.name:'';
      document.getElementById('modal-sign-common').value=s?s.commonName:'';
      prev.src=s?s.imageData:placeholderImage;
      imgIn.value='';
      modal.style.display='flex';
    }
    
    document.getElementById('open-add-sign-btn').onclick=()=>openSignModal();
    document.getElementById('close-add-sign-btn').onclick=()=>modal.style.display='none';
    document.getElementById('cancel-add-sign-btn').onclick=()=>modal.style.display='none';
    modal.onclick=e=>{ if(e.target===modal) modal.style.display='none'; };

    imgIn.onchange=e=>{
      const f=e.target.files[0]; 
      if(!f){prev.src=placeholderImage;return}
      const r=new FileReader(); 
      r.onload=ev=>prev.src=ev.target.result; 
      r.readAsDataURL(f);
    };
    
    form.onsubmit=e=>{
      e.preventDefault();
      const tn=document.getElementById('modal-sign-name').value.trim(),
            cn=document.getElementById('modal-sign-common').value.trim();
      if(!tn||!cn){alert('Names required');return;}
      
      const f=imgIn.files[0];
      const processSign = async (img) => {
        const signData = {
          name: tn,
          commonName: cn,
          imageData: img || buildImageUrl(tn) // Use GitHub images or uploaded image
        };
        
        if(editingSign){
          // Update existing sign in Firebase
          await updateSignInFirebase(editingSign.id, signData);
        } else {
          // Add new sign to Firebase
          await addSignToFirebase(signData);
        }
        
        modal.style.display='none';
        
        // Clear search to show updated results
        const searchInput = document.getElementById('sign-search');
        if (searchInput && searchInput.value) {
          searchInput.value = '';
        }
      };
      
      if(f) {
        const rdr=new FileReader();
        rdr.onload=ev=>processSign(ev.target.result);
        rdr.readAsDataURL(f);
      } else {
        processSign(prev.src);
      }
    };

    // Routes functionality - full implementation
    let editingRoute = null;
    
    function renderRoutes(){
      const routeList=document.getElementById('route-list');
      if(!routes.length){
        routeList.innerHTML='<div style="padding:.6rem;color:#666">No routes created yet. Use the form above to create your first route.</div>';
        return;
      }
      
      routeList.innerHTML='';
      routes.forEach(route => {
        const routeDiv = document.createElement('div');
        routeDiv.innerHTML = `
          <div style="flex:1">
            <strong style="color:#00345b">${route.name}</strong>
            <small style="display:block;color:#666;margin-top:0.25rem">${route.entries?.length || 0} sign entries</small>
          </div>
          <div>
            <button onclick="editRoute('${route.id}')" style="background:none;border:none;color:#005a9c;cursor:pointer;margin-right:0.5rem" title="Edit route">✎</button>
            <button onclick="deleteRoute('${route.id}')" style="background:none;border:none;color:#d00;cursor:pointer" title="Delete route">×</button>
          </div>
        `;
        routeList.appendChild(routeDiv);
      });
    }
    
    function renderRouteSelect(){
      const sel=document.getElementById('perm-route-select');
      sel.innerHTML='<option value="">-- Select a Route --</option>';
      routes.forEach(r=>{
        const o=document.createElement('option');
        o.value=r.id;
        o.text=r.name;
        sel.append(o);
      });
      
      // Enable/disable start inspection button
      document.getElementById('start-perm-inspection-btn').disabled = routes.length === 0;
    }
    
    function addRouteEntry() {
      const tbody = document.getElementById('route-entries-body');
      const entryId = uuid();
      
      const row = document.createElement('tr');
      row.setAttribute('data-entry-id', entryId);
      row.innerHTML = `
        <td>
          <select class="route-sign-select" style="width:100%;padding:0.25rem" required>
            <option value="">-- Select Sign --</option>
            ${signs.map(sign => `<option value="${sign.id}">${sign.name} - ${sign.commonName}</option>`).join('')}
          </select>
        </td>
        <td><input type="text" class="route-station" placeholder="10+000.00" maxlength="9" style="width:100%;padding:0.25rem"/></td>
        <td><input type="text" class="route-highway" placeholder="HWY 401 E" style="width:100%;padding:0.25rem"/></td>
        <td><input type="text" class="route-end" placeholder="10+100.00" maxlength="9" style="width:100%;padding:0.25rem"/></td>
        <td><button type="button" onclick="removeRouteEntry('${entryId}')" style="background:none;border:none;color:#d00;cursor:pointer">×</button></td>
      `;
      
      tbody.appendChild(row);
    }
    
    function removeRouteEntry(entryId) {
      const row = document.querySelector(`tr[data-entry-id="${entryId}"]`);
      if (row) {
        row.remove();
      }
    }
    
    function clearRouteForm() {
      document.getElementById('route-name').value = '';
      document.getElementById('route-entries-body').innerHTML = '';
      editingRoute = null;
      document.querySelector('#route-form button[type="submit"]').textContent = 'Save Route';
    }
    
    function saveRoute(formData) {
      const routeName = formData.get('route-name').trim();
      if (!routeName) {
        alert('Route name is required');
        return;
      }
      
      // Collect route entries
      const entries = [];
      const rows = document.querySelectorAll('#route-entries-body tr');
      
      rows.forEach(row => {
        const signId = row.querySelector('.route-sign-select').value;
        const station = row.querySelector('.route-station').value.trim();
        const highway = row.querySelector('.route-highway').value.trim();
        const end = row.querySelector('.route-end').value.trim();
        
        if (signId) { // Only add entries with a selected sign
          const sign = signs.find(s => s.id === signId);
          entries.push({
            id: uuid(),
            signId: signId,
            signName: sign ? sign.name : '',
            signCommonName: sign ? sign.commonName : '',
            station: station,
            highway: highway,
            end: end
          });
        }
      });
      
      if (entries.length === 0) {
        alert('Please add at least one sign entry to the route');
        return;
      }
      
      const routeData = {
        id: editingRoute ? editingRoute.id : uuid(),
        name: routeName,
        entries: entries,
        created: editingRoute ? editingRoute.created : new Date().toISOString(),
        modified: new Date().toISOString()
      };
      
      if (editingRoute) {
        // Update existing route
        const index = routes.findIndex(r => r.id === editingRoute.id);
        routes[index] = routeData;
        showNotification(`✅ Route "${routeName}" updated!`);
      } else {
        // Add new route
        routes.push(routeData);
        showNotification(`✅ Route "${routeName}" created with ${entries.length} signs!`);
      }
      
      // Clear form and refresh displays
      clearRouteForm();
      renderRoutes();
      renderRouteSelect();
    }
    
    function editRoute(routeId) {
      const route = routes.find(r => r.id === routeId);
      if (!route) return;
      
      editingRoute = route;
      
      // Fill form
      document.getElementById('route-name').value = route.name;
      document.querySelector('#route-form button[type="submit"]').textContent = 'Update Route';
      
      // Clear existing entries
      document.getElementById('route-entries-body').innerHTML = '';
      
      // Add route entries
      route.entries.forEach(entry => {
        addRouteEntry();
        const lastRow = document.querySelector('#route-entries-body tr:last-child');
        lastRow.querySelector('.route-sign-select').value = entry.signId;
        lastRow.querySelector('.route-station').value = entry.station || '';
        lastRow.querySelector('.route-highway').value = entry.highway || '';
        lastRow.querySelector('.route-end').value = entry.end || '';
      });
      
      // Scroll to form
      document.getElementById('route-form').scrollIntoView({ behavior: 'smooth' });
    }
    
    function deleteRoute(routeId) {
      const route = routes.find(r => r.id === routeId);
      if (!route) return;
      
      if (confirm(`Delete route "${route.name}"? This cannot be undone.`)) {
        routes = routes.filter(r => r.id !== routeId);
        renderRoutes();
        renderRouteSelect();
        showNotification(`🗑️ Route "${route.name}" deleted`);
        
        // Clear form if editing this route
        if (editingRoute && editingRoute.id === routeId) {
          clearRouteForm();
        }
      }
    }
    
    // Route form event handlers
    document.getElementById('add-route-entry-btn').addEventListener('click', addRouteEntry);
    
    document.getElementById('route-form').addEventListener('submit', function(e) {
      e.preventDefault();
      const formData = new FormData(this);
      saveRoute(formData);
    });
    
    // Global functions for inline handlers
    window.editRoute = editRoute;
    window.deleteRoute = deleteRoute;
    window.removeRouteEntry = removeRouteEntry;

    // Permanent inspection functionality
    document.getElementById('perm-route-select').addEventListener('change', function() {
      const routeId = this.value;
      document.getElementById('start-perm-inspection-btn').disabled = !routeId;
    });
    
    document.getElementById('start-perm-inspection-btn').addEventListener('click', function() {
      const routeId = document.getElementById('perm-route-select').value;
      if (!routeId) return;
      
      const route = routes.find(r => r.id === routeId);
      if (!route) return;
      
      startPermInspection(route);
    });
    
    function startPermInspection(route) {
      document.getElementById('perm-select-div').style.display = 'none';
      document.getElementById('perm-inspect-div').style.display = 'block';
      document.getElementById('perm-inspect-title').textContent = `Inspecting Route: ${route.name}`;
      
      // Clear previous entries
      permEntries = [];
      
      // Create inspection cards for each route entry
      const permGrid = document.getElementById('perm-grid');
      permGrid.innerHTML = '';
      
      route.entries.forEach(entry => {
        const sign = signs.find(s => s.id === entry.signId);
        if (!sign) return;
        
        const inspectionEntry = {
          id: uuid(),
          routeEntryId: entry.id,
          signId: entry.signId,
          station: entry.station,
          highway: entry.highway,
          status: 'present', // Default status
          notes: '',
          timestamp: new Date().toISOString()
        };
        
        permEntries.push(inspectionEntry);
        
        const card = document.createElement('div');
        card.className = 'perm-card';
        card.innerHTML = `
          <img src="${sign.imageData}" alt="${sign.name}">
          <div style="text-align:center">
            <h4 style="color:#00345b;margin-bottom:0.25rem">${sign.name}</h4>
            <p style="font-size:0.85rem;color:#666;margin-bottom:0.5rem">${sign.commonName}</p>
            <p style="font-size:0.8rem;color:#333;margin-bottom:0.5rem">
              <strong>Station:</strong> ${entry.station || 'N/A'}<br>
              <strong>Highway:</strong> ${entry.highway || 'N/A'}
            </p>
            <select onchange="updatePermStatus('${inspectionEntry.id}', this.value)" style="width:100%;padding:0.25rem;margin-bottom:0.5rem">
              <option value="present">✅ Present</option>
              <option value="missing">❌ Missing</option>
              <option value="damaged">⚠️ Damaged</option>
              <option value="repositioned">🔄 Repositioned</option>
            </select>
            <textarea placeholder="Notes (optional)" onchange="updatePermNotes('${inspectionEntry.id}', this.value)" 
                      style="width:100%;height:50px;padding:0.25rem;font-size:0.8rem;resize:vertical"></textarea>
          </div>
        `;
        
        permGrid.appendChild(card);
      });
    }
    
    function updatePermStatus(entryId, status) {
      const entry = permEntries.find(e => e.id === entryId);
      if (entry) {
        entry.status = status;
        entry.modified = new Date().toISOString();
      }
    }
    
    function updatePermNotes(entryId, notes) {
      const entry = permEntries.find(e => e.id === entryId);
      if (entry) {
        entry.notes = notes;
        entry.modified = new Date().toISOString();
      }
    }
    
    document.getElementById('save-permanent-btn').addEventListener('click', function() {
      if (permEntries.length === 0) {
        alert('No inspection data to save');
        return;
      }
      
      const routeId = document.getElementById('perm-route-select').value;
      const route = routes.find(r => r.id === routeId);
      
      const inspectionLog = {
        id: uuid(),
        routeId: routeId,
        routeName: route.name,
        entries: permEntries,
        timestamp: new Date().toISOString(),
        inspector: 'Current User' // Could be made configurable
      };
      
      // Save to permanent logs
      permLogs.push(inspectionLog);
      
      // Generate PDF (simplified)
      generatePermInspectionPDF(inspectionLog);
      
      // Reset form
      document.getElementById('perm-select-div').style.display = 'block';
      document.getElementById('perm-inspect-div').style.display = 'none';
      document.getElementById('perm-route-select').value = '';
      document.getElementById('start-perm-inspection-btn').disabled = true;
      
      showNotification(`✅ Permanent inspection completed for "${route.name}"`);
      renderInspectionList();
    });
    
    function generatePermInspectionPDF(inspectionLog) {
      // Generate PDF content for the inspection
      const content = `
PERMANENT SIGN INSPECTION REPORT
Route: ${inspectionLog.routeName}
Date: ${new Date(inspectionLog.timestamp).toLocaleDateString()}
Inspector: ${inspectionLog.inspector}

INSPECTION RESULTS:
${inspectionLog.entries.map(entry => {
  const sign = signs.find(s => s.id === entry.signId);
  return `
• ${sign?.name} - ${sign?.commonName}
  Station: ${entry.station || 'N/A'}
  Highway: ${entry.highway || 'N/A'}
  Status: ${entry.status}
  Notes: ${entry.notes || 'None'}
`;
}).join('')}

Generated: ${new Date().toLocaleString()}
      `;
      
      // Convert to base64 for download
      const blob = new Blob([content], { type: 'text/plain' });
      const reader = new FileReader();
      reader.onload = function() {
        const base64 = reader.result.split(',')[1];
        
        // Use route name as the PDF name (or first sign name if single sign)
        const routeNameClean = inspectionLog.routeName.replace(/[^a-zA-Z0-9\-\_]/g, '_');
        const pdfName = `inspection_${routeNameClean}`;
        
        downloadPDF(
          base64,
          pdfName,
          'Permanent Inspection Report'
        );
      };
      reader.readAsDataURL(blob);
    }
    
    function renderInspectionList() {
      const inspectionList = document.getElementById('inspection-list');
      const allLogs = [...permLogs, ...dailyLogs].sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
      
      if (allLogs.length === 0) {
        inspectionList.innerHTML = '<div style="padding:.6rem;color:#666">No inspections completed yet.</div>';
        return;
      }
      
      inspectionList.innerHTML = '';
      allLogs.forEach(log => {
        const logDiv = document.createElement('div');
        const isPermLog = permLogs.includes(log);
        const date = new Date(log.timestamp).toLocaleDateString();
        
        logDiv.innerHTML = `
          <div style="flex:1">
            <strong style="color:#00345b">${isPermLog ? '🛣️ Permanent' : '📅 Daily'}: ${log.routeName || 'Daily Inspection'}</strong>
            <small style="display:block;color:#666;margin-top:0.25rem">${date} - ${log.entries?.length || 0} entries</small>
          </div>
          <div>
            <button onclick="downloadInspectionReport('${log.id}')" style="background:none;border:none;color:#005a9c;cursor:pointer" title="Download report">📥</button>
          </div>
        `;
        inspectionList.appendChild(logDiv);
      });
    }
    
    // Debug helper to test Firebase connection
    function testFirebaseConnection() {
      console.log('🔧 Testing Firebase connection...');
      
      if (!window.firebaseDb) {
        console.error('❌ Firebase not initialized');
        return false;
      }
      
      try {
        const { collection } = window.firebaseUtils;
        const testCollection = collection(window.firebaseDb, 'signs');
        console.log('✅ Firebase connection OK');
        console.log('🔍 Signs collection reference:', testCollection);
        return true;
      } catch (error) {
        console.error('❌ Firebase connection test failed:', error);
        return false;
      }
    }
    
    // Global functions for permanent inspection
    window.updatePermStatus = updatePermStatus;
    window.updatePermNotes = updatePermNotes;
    window.downloadInspectionReport = function(logId) {
      const log = [...permLogs, ...dailyLogs].find(l => l.id === logId);
      if (log) {
        const isPermLog = permLogs.includes(log);
        if (isPermLog) {
          generatePermInspectionPDF(log);
        } else {
          // Handle daily log download if needed
          showNotification('Daily inspection download - feature coming soon');
        }
      }
    };
    
    // Add global debug functions
    window.testFirebaseConnection = testFirebaseConnection;
    window.debugFirebase = function() {
      console.log('=== FIREBASE DEBUG INFO ===');
      console.log('Firebase DB:', window.firebaseDb);
      console.log('Firebase Storage:', window.firebaseStorage);
      console.log('Firebase Utils:', window.firebaseUtils);
      console.log('Current signs:', signs);
      testFirebaseConnection();
    };
    
    // Helper to test image loading from GitHub Pages
    window.testImageLoading = function(signName = 'TC-1') {
      const imageUrl = buildImageUrl(signName);
      console.log(`🖼️ Testing image: ${imageUrl}`);
      
      const img = new Image();
      img.onload = () => console.log(`✅ Image loaded successfully: ${imageUrl}`);
      img.onerror = () => console.log(`❌ Image failed to load: ${imageUrl}`);
      img.src = imageUrl;
      
      return imageUrl;
    };
    
    // Helper to test PDF loading from YOUR exact GitHub location
    window.testPDFLoading = async function(signName = 'TC-1') {
      const pdfUrl = buildPDFUrl(signName);
      console.log(`📄 Testing PDF at EXACT location: ${pdfUrl}`);
      console.log(`📁 Repository: https://github.com/og-nater-tater/mywebiste/tree/52aa664608fa5a456ed7b5fef1e0604dae3aac60/signs`);
      console.log(`📁 Expected file: ${signName}.pdf`);
      
      const exists = await checkPDFExists(signName);
      if (exists) {
        console.log(`✅ PDF found and accessible: ${pdfUrl}`);
      } else {
        console.log(`❌ PDF not found: ${pdfUrl}`);
        console.log(`💡 Make sure ${signName}.pdf exists in your /signs/ folder`);
        console.log(`💡 GitHub repo: https://github.com/og-nater-tater/mywebiste/blob/main/signs/${signName}.pdf`);
      }
      
      return { url: pdfUrl, exists };
    };
    
    // Helper to test YOUR exact GitHub Pages structure
    window.testGitHubPagesStructure = async function() {
      console.log('🔧 Testing YOUR EXACT GitHub Pages structure...');
      console.log('📍 Repository: https://github.com/og-nater-tater/mywebiste/tree/52aa664608fa5a456ed7b5fef1e0604dae3aac60/signs');
      console.log('📍 GitHub Pages PDFs: https://og-nater-tater.github.io/mywebiste/signs/');
      console.log('📍 App URL: https://og-nater-tater.github.io/mywebiste/sign-daily.html');
      
      const testSigns = ['TC-1', 'TC-2A', 'Ra-1'];
      
      for (const signName of testSigns) {
        console.log(`\n--- Testing ${signName} ---`);
        
        // Test PDF at exact location
        const pdfExists = await checkPDFExists(signName);
        const pdfUrl = buildPDFUrl(signName);
        
        console.log(`📄 PDF (${pdfUrl}): ${pdfExists ? '✅ FOUND' : '❌ NOT FOUND'}`);
        
        if (!pdfExists) {
          console.log(`   💡 Upload ${signName}.pdf to: https://github.com/og-nater-tater/mywebiste/tree/main/signs/`);
          console.log(`   📁 Should be accessible at: ${pdfUrl}`);
        }
      }
      
      console.log('\n🎯 YOUR EXACT Structure:');
      console.log('Repository: og-nater-tater/mywebiste');
      console.log('/signs/');
      console.log('├── TC-1.pdf     ← PDFs HERE');
      console.log('├── TC-2A.pdf    ← PDFs HERE');  
      console.log('└── Ra-1.pdf     ← PDFs HERE');
      console.log('\nGitHub Pages URLs:');
      console.log('https://og-nater-tater.github.io/mywebiste/signs/TC-1.pdf');
      console.log('https://og-nater-tater.github.io/mywebiste/signs/TC-2A.pdf');
      console.log('https://og-nater-tater.github.io/mywebiste/signs/Ra-1.pdf');
    };
    
    // Show detailed setup instructions
    window.showSetupInstructions = function() {
      const instructions = `
🔥 FIREBASE SETUP INSTRUCTIONS

1. Go to: https://console.firebase.google.com
2. Click "Create a project" 
3. Name it: "construction-signs-app"
4. Disable Google Analytics
5. Click "Create project"

6. Enable Firestore:
   • Click "Firestore Database" → "Create database"
   • Choose "Start in test mode" → Select location → Done

7. Enable Storage:
   • Click "Storage" → "Get started" → Keep default rules → Same location → Done

8. Get Config:
   • Click ⚙️ → "Project settings"
   • Scroll to "Your apps" → Click </> Web icon
   • Name: "Construction Signs Web App" → Register app
   • COPY the firebaseConfig object

9. Update Code:
   • Replace the firebaseConfig object around line 680 in this HTML file
   • Save and refresh the page

10. Test:
    • Open browser console (F12)
    • Type: debugFirebase()
    • Should see "Firebase connection OK"

📁 GITHUB PAGES STRUCTURE:
Your PDFs should be named after technical sign names:
• TC-1.pdf, TC-2A.pdf, Ra-1.pdf, etc.
• Place them directly in /signs/ folder (not in subfolder)
• Images go in /signs/images/ folder

🧪 TESTING COMMANDS:
• debugFirebase() - Test Firebase connection
• testImageLoading('TC-1') - Test image loading
• testPDFLoading('TC-1') - Test PDF loading  
• testGitHubPagesStructure() - Test complete structure

Need help? Check console errors for details.
      `;
      
      alert(instructions);
      console.log(instructions);
    };
    
    // Complete setup status check
    window.checkSetupStatus = async function() {
      console.log('🔧 SETUP STATUS CHECK');
      console.log('========================');
      
      // Firebase check
      const firebaseOK = testFirebaseConnection();
      console.log(`🔥 Firebase: ${firebaseOK ? '✅ Connected' : '❌ Not connected'}`);
      
      // Signs data check
      console.log(`📋 Signs in database: ${signs.length}`);
      
      // GitHub Pages structure check
      console.log('📁 GitHub Pages structure:');
      await testGitHubPagesStructure();
      
      console.log('\n🎯 NEXT STEPS:');
      if (!firebaseOK) {
        console.log('1. ❌ Fix Firebase configuration first');
      } else if (signs.length === 0) {
        console.log('1. ✅ Firebase connected');
        console.log('2. 🟡 Click "Create Sample Signs" to add initial data');
      } else {
        console.log('1. ✅ Firebase connected');
        console.log('2. ✅ Signs loaded');
        console.log('3. 🟡 Upload sign images to /signs/images/ folder');
        console.log('4. 🟡 Upload sign PDFs to /signs/ folder (named by technical name)');
      }
    };

    // Daily sign search functionality
    function initializeDailySearch() {
      console.log('Initializing daily search with', signs.length, 'signs');
      
      const searchInput = document.getElementById('daily-sign-search');
      const suggestionsDiv = document.getElementById('daily-sign-suggestions');
      const hiddenInput = document.getElementById('daily-sign-id');
      const addBtn = document.getElementById('add-daily-entry-btn');
      
      if (!searchInput || !suggestionsDiv || !hiddenInput || !addBtn) {
        console.error('Daily search elements not found');
        return;
      }

      updateDailySearchPlaceholder();
      
      // Clear any existing event listeners
      searchInput.replaceWith(searchInput.cloneNode(true));
      const newSearchInput = document.getElementById('daily-sign-search');
      
      // Input event for real-time search
      newSearchInput.addEventListener('input', function() {
        const query = this.value.trim().toLowerCase();
        selectedSuggestionIndex = -1;
        
        if (query.length === 0) {
          hideSuggestions();
          clearSelection();
          return;
        }
        
        // Filter signs based on search query
        dailySearchSuggestions = signs.filter(sign => {
          const searchText = (sign.name + ' ' + sign.commonName).toLowerCase();
          return searchText.includes(query);
        });
        
        showSuggestions(dailySearchSuggestions);
      });
      
      // Keyboard navigation
      newSearchInput.addEventListener('keydown', function(e) {
        const suggestionsDiv = document.getElementById('daily-sign-suggestions');
        const suggestions = suggestionsDiv.querySelectorAll('.suggestion-item');
        
        switch(e.key) {
          case 'ArrowDown':
            e.preventDefault();
            if (selectedSuggestionIndex < suggestions.length - 1) {
              selectedSuggestionIndex++;
              updateSuggestionHighlight();
            }
            break;
            
          case 'ArrowUp':
            e.preventDefault();
            if (selectedSuggestionIndex > 0) {
              selectedSuggestionIndex--;
              updateSuggestionHighlight();
            }
            break;
            
          case 'Enter':
            e.preventDefault();
            if (selectedSuggestionIndex >= 0 && suggestions[selectedSuggestionIndex]) {
              suggestions[selectedSuggestionIndex].click();
            }
            break;
            
          case 'Escape':
            hideSuggestions();
            this.blur();
            break;
        }
      });
      
      // Hide suggestions when clicking outside
      document.addEventListener('click', function(e) {
        if (!e.target.closest('#daily-sign-search') && !e.target.closest('#daily-sign-suggestions')) {
          hideSuggestions();
        }
      });
    }

    function showSuggestions(suggestions) {
      const suggestionsDiv = document.getElementById('daily-sign-suggestions');
      
      if (suggestions.length === 0) {
        suggestionsDiv.innerHTML = '<div style="padding:0.75rem;color:#666;text-align:center">No signs found</div>';
        suggestionsDiv.style.display = 'block';
        return;
      }
      
      suggestionsDiv.innerHTML = '';
      
      suggestions.forEach((sign, index) => {
        const suggestionItem = document.createElement('div');
        suggestionItem.className = 'suggestion-item';
        suggestionItem.innerHTML = `
          <img src="${sign.imageData}" alt="${sign.name}">
          <div>
            <div style="font-weight:500;color:#00345b">${sign.name}</div>
            <div style="font-size:0.85rem;color:#666">${sign.commonName}</div>
          </div>
        `;
        
        suggestionItem.addEventListener('click', function() {
          selectSign(sign);
        });
        
        suggestionsDiv.appendChild(suggestionItem);
      });
      
      suggestionsDiv.style.display = 'block';
      selectedSuggestionIndex = -1;
    }

    function hideSuggestions() {
      document.getElementById('daily-sign-suggestions').style.display = 'none';
      selectedSuggestionIndex = -1;
    }

    function updateSuggestionHighlight() {
      const suggestions = document.querySelectorAll('.suggestion-item');
      suggestions.forEach((item, index) => {
        item.classList.toggle('active', index === selectedSuggestionIndex);
      });
    }

    function selectSign(sign) {
      const searchInput = document.getElementById('daily-sign-search');
      const hiddenInput = document.getElementById('daily-sign-id');
      const addBtn = document.getElementById('add-daily-entry-btn');
      
      searchInput.value = `${sign.name} - ${sign.commonName}`;
      hiddenInput.value = sign.id;
      
      addBtn.disabled = false;
      addBtn.textContent = '+ Add Entry';
      addBtn.style.background = '#005a9c';
      
      hideSuggestions();
    }

    function clearSelection() {
      const hiddenInput = document.getElementById('daily-sign-id');
      const addBtn = document.getElementById('add-daily-entry-btn');
      
      hiddenInput.value = '';
      addBtn.disabled = true;
      addBtn.textContent = '+ Select Sign First';
      addBtn.style.background = '#999';
    }

    function clearDailySearch() {
      const searchInput = document.getElementById('daily-sign-search');
      const suggestionsDiv = document.getElementById('daily-sign-suggestions');
      
      if (searchInput) {
        searchInput.value = '';
      }
      if (suggestionsDiv) {
        suggestionsDiv.style.display = 'none';
      }
      
      clearSelection();
      updateDailySearchPlaceholder();
    }

    function updateDailySearchPlaceholder() {
      const searchInput = document.getElementById('daily-sign-search');
      if (!searchInput) return;
      
      if (signs.length === 0) {
        searchInput.placeholder = 'No signs available - load signs_library.json first';
        searchInput.disabled = true;
      } else {
        searchInput.placeholder = `Search ${signs.length} signs (TC-21, Stop, Construction...)`;
        searchInput.disabled = false;
      }
    }

    // Add daily entry functionality (basic stub)
    document.getElementById('add-daily-entry-btn').addEventListener('click', function() {
      const signId = document.getElementById('daily-sign-id').value;
      const station = document.getElementById('daily-station').value.trim();
      const highway = document.getElementById('daily-highway').value.trim();
      
      if (!signId) {
        showNotification('❌ Please select a sign first', 'warning');
        return;
      }
      
      const sign = signs.find(s => s.id === signId);
      if (!sign) {
        showNotification('❌ Selected sign not found', 'warning');
        return;
      }
      
      if (!dailyEntries) {
        dailyEntries = [];
      }
      
      // Add entry to daily diary
      const entry = {
        id: uuid(),
        signId: signId,
        station: station,
        highway: highway,
        timestamp: new Date().toISOString()
      };
      
      dailyEntries.push(entry);
      
      // Update the table
      updateDailyDiaryTable();
      
      // Clear the form
      clearDailySearch();
      document.getElementById('daily-station').value = '';
      document.getElementById('daily-highway').value = '';
      
      showNotification(`✅ Added ${sign.name} to daily diary`);
    });

    // Update daily diary table
    function updateDailyDiaryTable() {
      const tbody = document.getElementById('daily-diary-body');
      if (!tbody || !dailyEntries) return;
      
      tbody.innerHTML = '';
      
      if (dailyEntries.length === 0) {
        tbody.innerHTML = '<tr><td colspan="5" style="text-align:center;color:#666;padding:1rem">No entries yet</td></tr>';
        return;
      }
      
      dailyEntries.forEach(entry => {
        const sign = signs.find(s => s.id === entry.signId);
        if (!sign) return;
        
        const row = document.createElement('tr');
        row.innerHTML = `
          <td><img src="${sign.imageData}" style="width:30px;height:30px;object-fit:cover;border:1px solid #ccc;border-radius:4px"></td>
          <td>${sign.name}<br><small style="color:#666">${sign.commonName}</small></td>
          <td>${entry.station || '-'}</td>
          <td>${entry.highway || '-'}</td>
          <td>
            <button onclick="removeDailyEntry('${entry.id}')" style="background:none;border:none;color:#d00;cursor:pointer">Remove</button>
          </td>
        `;
        tbody.appendChild(row);
      });
    }

    // Remove daily entry
    window.removeDailyEntry = function(entryId) {
      if (confirm('Remove this entry?')) {
        dailyEntries = dailyEntries.filter(e => e.id !== entryId);
        updateDailyDiaryTable();
        showNotification('✅ Entry removed');
      }
    };

    // Global functions for inline onclick handlers
    window.removeDailyEntry = function(entryId) {
      if (confirm('Remove this entry?')) {
        dailyEntries = dailyEntries.filter(e => e.id !== entryId);
        updateDailyDiaryTable();
        showNotification('✅ Entry removed');
      }
    };
    
    window.clearRouteForm = clearRouteForm;
    window.openSignModal = openSignModal;

    // Set today's date as default
    const dateInput = document.getElementById('project-date');
    if(dateInput) {
      dateInput.value = new Date().toISOString().split('T')[0];
    }

    // Initialize daily search functionality - delayed to ensure DOM is ready
    setTimeout(() => {
      console.log('Initial daily search setup');
      initializeDailySearch();
    }, 500);

    // Initial render and setup Firebase
    renderSigns();
    renderRoutes();
    renderRouteSelect();
    renderInspectionList();
    
    // Setup Firebase real-time listeners
    setupFirebaseSignsListener();
    
    // Add one initial route entry to show users how the form works
    setTimeout(() => {
      if (signs.length > 0) {
        addRouteEntry();
      }
    }, 2000); // Wait a bit longer for Firebase to load
    
    } // End of startApplication function
  });
  </script>
</body>
</html>